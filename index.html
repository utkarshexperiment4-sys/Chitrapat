<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metube - वीडियो प्लेटफॉर्म</title>
    <!-- आइकन्स -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <!-- फॉन्ट्स -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap">
    <!-- स्टाइलशीट -->
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- लोडिंग स्क्रीन -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loader"></div>
        <h2>Metube शुरू हो रहा है...</h2>
    </div>

    <div id="appContainer" class="app-container" style="display: none;">
        
        <!-- हेडर (Header) -->
        <header class="header">
            <div class="header-left">
                <button class="menu-btn" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="logo" onclick="showPage('homePage')">
                    <div class="logo-icon">M</div>
                    <span class="logo-text">Metube</span>
                </div>
            </div>
            
            <div class="header-center">
                <div class="search-container">
                    <input type="text" class="search-input" id="searchInput" placeholder="सर्च करें...">
                    <button class="search-btn" onclick="searchVideos()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>

            <div class="header-right">
                <!-- अपलोड बटन -->
                <button class="upload-btn" onclick="showPage('uploadPage')">
                    <i class="fas fa-video"></i>
                    <span>अपलोड</span>
                </button>
                
                <div id="userSection" class="user-section">
                    <!-- ऑथेंटिकेशन स्टेट यहां JS द्वारा हैंडल की जाएगी -->
                    <button id="loginBtn" class="login-btn" onclick="signInAnonymously(auth)">
                        <i class="fas fa-user-circle"></i>
                        <span>लॉगिन</span>
                    </button>
                    <div id="loggedUser" class="logged-user" style="display: none;">
                        <img id="userAvatar" class="user-avatar" src="https://placehold.co/36x36/888/fff?text=G" alt="उपयोगकर्ता अवतार">
                    </div>
                </div>
            </div>
        </header>

        <!-- साइडबार (Sidebar) -->
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-nav">
                <a href="#" class="nav-item active" onclick="showPage('homePage'); return false;">
                    <i class="fas fa-home"></i>
                    <span>होम</span>
                </a>
                <a href="#" class="nav-item" onclick="showPage('trendingPage'); return false;">
                    <i class="fas fa-fire"></i>
                    <span>ट्रेंडिंग</span>
                </a>
                <a href="#" class="nav-item" onclick="showPage('subscriptionsPage'); return false;">
                    <i class="fas fa-bell"></i>
                    <span>सब्सक्रिप्शन</span>
                </a>
                <hr class="divider">
                <span class="category-title">लाइब्रेरी</span>
                <a href="#" class="nav-item" onclick="showPage('historyPage'); return false;">
                    <i class="fas fa-history"></i>
                    <span>इतिहास</span>
                </a>
                <a href="#" class="nav-item" onclick="showPage('watchLaterPage'); return false;">
                    <i class="fas fa-clock"></i>
                    <span>बाद में देखें</span>
                </a>
            </div>
            <footer class="sidebar-footer">
                © 2024 Metube.
            </footer>
        </nav>

        <!-- मुख्य कंटेंट (Main Content) -->
        <main class="main-content">
            
            <!-- होम पेज -->
            <section id="homePage" class="page active">
                <div class="page-header">
                    <h2 class="page-title"><i class="fas fa-home"></i> आपके लिए</h2>
                    <div class="filter-buttons">
                        <button class="filter-btn active">सभी</button>
                        <button class="filter-btn">गेमिंग</button>
                        <button class="filter-btn">संगीत</button>
                        <button class="filter-btn">समाचार</button>
                    </div>
                </div>
                <div id="videosGrid" class="videos-grid">
                    <div class="loading-videos" id="loadingVideos">वीडियो लोड हो रहे हैं...</div>
                </div>
            </section>

            <!-- अपलोड पेज -->
            <section id="uploadPage" class="page">
                <div class="upload-container">
                    <h2 class="upload-title"><i class="fas fa-upload"></i> अपना वीडियो अपलोड करें</h2>
                    
                    <!-- 1. फ़ाइल चयन क्षेत्र -->
                    <div id="uploadArea" class="upload-area">
                        <i class="fas fa-cloud-upload-alt upload-icon"></i>
                        <p>वीडियो फ़ाइल को यहाँ ड्रैग और ड्रॉप करें</p>
                        <p>या</p>
                        <input type="file" id="fileInput" accept="video/*" onchange="handleFileInput(this.files[0])" style="display: none;">
                        <button class="select-file-btn" onclick="document.getElementById('fileInput').click()">फ़ाइल चुनें</button>
                        <p id="fileNameDisplay" class="upload-info">कोई फ़ाइल नहीं चुनी गई। (अधिकतम 100MB)</p>
                    </div>

                    <!-- 2. अपलोड प्रगति और फॉर्म (शुरुआत में छुपा हुआ) -->
                    <div id="uploadDetails" style="display: none;">
                        <!-- ध्यान दें: onsubmit में window.selectedFile का उपयोग किया गया है -->
                        <form id="uploadForm" onsubmit="window.uploadVideo(event, window.selectedFile)">
                            
                            <!-- प्रगति बार -->
                            <div id="uploadProgress" class="upload-progress">
                                <p class="progress-text" id="progressText">प्रगति: 0%</p>
                                <div class="progress-bar">
                                    <div id="progressFill" class="progress-fill" style="width: 0%;"></div>
                                </div>
                                <p class="upload-speed" id="uploadSpeed">0 KB/s</p>
                            </div>

                            <!-- वीडियो विवरण -->
                            <div class="form-group">
                                <label for="title">शीर्षक (Title)*</label>
                                <input type="text" id="title" required placeholder="वीडियो का आकर्षक शीर्षक डालें">
                            </div>
                            
                            <div class="form-group">
                                <label for="description">विवरण (Description)*</label>
                                <textarea id="description" rows="5" required placeholder="वीडियो के बारे में विस्तार से बताएं"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="category">श्रेणी (Category)*</label>
                                <select id="category" required>
                                    <option value="">श्रेणी चुनें</option>
                                    <option value="gaming">गेमिंग</option>
                                    <option value="music">संगीत</option>
                                    <option value="news">समाचार</option>
                                    <option value="tech">टेक्नोलॉजी</option>
                                    <option value="other">अन्य</option>
                                </select>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="cancel-btn" onclick="showPage('homePage')">रद्द करें</button>
                                <button type="submit" id="uploadSubmitBtn" class="upload-submit-btn">
                                    <i class="fas fa-cloud-upload-alt"></i> अपलोड शुरू करें
                                </button>
                            </div>
                        </form>
                    </div>

                </div>
            </section>
            
            <!-- वीडियो प्लेयर पेज और अन्य डमी पेज... (बाकी पेजों के सेक्शन यहाँ हैं) -->
            <section id="playerPage" class="page">
                <h2 class="page-title"><i class="fas fa-play-circle"></i> वीडियो प्लेयर</h2>
                <p style="color: #888;">वीडियो प्लेयर पेज का लॉजिक अभी `app.js` में जोड़ा जाना बाकी है।</p>
            </section>
            <section id="trendingPage" class="page">
                <h2 class="page-title"><i class="fas fa-fire"></i> ट्रेंडिंग वीडियो</h2>
                <p style="color: #888;">यह पेज अभी बनाया जा रहा है। जल्द ही यहाँ नए ट्रेंडिंग वीडियो दिखेंगे।</p>
            </section>
            <section id="subscriptionsPage" class="page">
                <h2 class="page-title"><i class="fas fa-bell"></i> सब्सक्रिप्शन</h2>
                <p style="color: #888;">यह पेज अभी बनाया जा रहा है। जल्द ही आपके सब्सक्राइब्ड चैनलों के वीडियो यहाँ दिखेंगे।</p>
            </section>
        
        </main>

        <!-- बॉटम नेविगेशन (मोबाइल के लिए) -->
        <nav id="bottomNav" class="bottom-nav">
            <a href="#" class="nav-item active" onclick="showPage('homePage'); return false;">
                <i class="fas fa-home"></i>
                <span>होम</span>
            </a>
            <a href="#" class="nav-item" onclick="showPage('trendingPage'); return false;">
                <i class="fas fa-fire"></i>
                <span>ट्रेंडिंग</span>
            </a>
            <button class="nav-item upload-nav-btn" onclick="showPage('uploadPage'); return false;">
                <i class="fas fa-plus"></i>
            </button>
            <a href="#" class="nav-item" onclick="showPage('subscriptionsPage'); return false;">
                <i class="fas fa-bell"></i>
                <span>सब्सक्रिप्शन</span>
            </a>
            <a href="#" class="nav-item" onclick="showPage('historyPage'); return false;">
                <i class="fas fa-user"></i>
                <span>आप</span>
            </a>
        </nav>
    </div>

    <!-- Firebase SDKs और App Logic -->
    <script type="module">
        // Firebase V11 SDKs
        import { initializeApp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";
        
        // App Logic को इंपोर्ट करें
        import { initMetubeApp, showPage, toggleSidebar, uploadVideo, loadVideos } from './app.js';
        
        // ग्लोबल कॉन्फ़िगरेशन
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // Firebase सर्विसेज
        let app, auth, db, storage;
        
        // फ़ाइल इनपुट के लिए ग्लोबल वेरिएबल
        window.selectedFile = null;

        // फ़ाइल इनपुट हैंडलर
        window.handleFileInput = (file) => {
            if (file) {
                window.selectedFile = file;
                document.getElementById('fileNameDisplay').textContent = `चुनी गई फ़ाइल: ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
                document.getElementById('uploadDetails').style.display = 'block';
                // फाइल चुनने पर प्रगति बार रीसेट करें
                document.getElementById('progressFill').style.width = '0%';
                document.getElementById('progressText').textContent = 'प्रगति: 0%';
                document.getElementById('uploadSpeed').textContent = '0 KB/s';
            } else {
                window.selectedFile = null;
                document.getElementById('fileNameDisplay').textContent = 'कोई फ़ाइल नहीं चुनी गई।';
                document.getElementById('uploadDetails').style.display = 'none';
            }
        };

        // मेन इनिशियलाइज़ेशन फ़ंक्शन
        window.onload = async function() {
            setLogLevel('debug'); // Firebase Debugging के लिए
            try {
                if (firebaseConfig) {
                    app = initializeApp(firebaseConfig);
                    auth = getAuth(app);
                    db = getFirestore(app);
                    storage = getStorage(app);
                    
                    // ऑथेंटिकेशन
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                        console.log("Firebase: Custom token sign in successful.");
                    } else {
                        await signInAnonymously(auth);
                        console.log("Firebase: Signed in anonymously.");
                    }
                    
                    // Metube App शुरू करें और सर्विसेज पास करें
                    initMetubeApp(appId, auth, db, storage);
                    
                } else {
                    console.error("Firebase config is missing. Application cannot start.");
                }

            } catch (error) {
                console.error("Firebase initialization failed:", error);
            } finally {
                // लोडिंग स्क्रीन हटाएँ और ऐप दिखाएँ
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('appContainer').style.display = 'grid'; 
                showPage('homePage');
            }
        };
        
        // ग्लोबल फ़ंक्शंस
        window.showPage = showPage;
        window.toggleSidebar = toggleSidebar;
        window.uploadVideo = uploadVideo; // app.js से इंपोर्ट किया गया
        window.loadVideos = loadVideos; // app.js से इंपोर्ट किया गया
        
        // Drag and Drop लॉजिक (अपलोड पेज के लिए)
        const uploadArea = document.getElementById('uploadArea');
        if (uploadArea) {
            uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); uploadArea.classList.add('drag-over'); });
            uploadArea.addEventListener('dragleave', () => { uploadArea.classList.remove('drag-over'); });
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('drag-over');
                const file = e.dataTransfer.files[0];
                handleFileInput(file);
            });
        }
    </script>
</body>
</html>

